<!DOCTYPE html>
<html>
  <head>
    <title>Single Page Site</title>
  </head>
  <body>
    <h1>Welcome to your single-page site!</h1>
    <form id="loginForm">
      <div>
        <label for="email">email: eve.holt@reqres.in</label>
        <input type="text" id="email" name="email" required>
      </div>
      <div>
        <label for="password">Password: cityslicka</label>
        <input type="password" id="password" name="password" required>
      </div>
      <button type="submit">Login</button>
    </form>
    <div id="message" style="display: none;"></div>
    <a href="#" id="logoutLink" style="display: none;">Logout</a>
    <script>
      window.localStorage.getItem("token");
      document.addEventListener("DOMContentLoaded", function() { 
        const loginForm = document.getElementById("loginForm");
        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const messageDiv = document.getElementById("message");
        const logoutLink = document.getElementById("logoutLink");
        const token = localStorage.getItem("token");
        const storedEmail = localStorage.getItem("email")
        console.log(storedEmail)
        if (token) {
          // If a token exists, show the logout link and hide the login form
          loginForm.style.display = "none";
          messageDiv.style.display = "block";
          messageDiv.textContent = "Hello, " + storedEmail;
          logoutLink.style.display = "block";
        } else {
          // If no token exists, show the login form
          loginForm.style.display = "none";
        }
        if (storedEmail) {
          emailInput.value = storedEmail;
        }
        loginForm.addEventListener("submit", function(e){
          e.preventDefault();
          const emailVal = emailInput.value;
          const passwordVal = passwordInput.value;
          const xhr = new XMLHttpRequest();
          xhr.open("POST", "https://reqres.in/api/login", true);
          xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
          xhr.onreadystatechange = () => {
            if(xhr.readyState === 4) {
              if(xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                if(response.token){
                  localStorage.setItem("token", response.token);
                  // Store the email in localStorage
                  localStorage.setItem("email", emailVal);
                  // Display greeting message
                  messageDiv.style.display = "block";
                  messageDiv.textContent = "Hello, " + emailVal;
                  loginForm.style.display = "none";
                  logoutLink.style.display = "block";
                } else {
                  // Authentication failed
                  messageDiv.textContent = "Authentication failed. Please try again.";
                  messageDiv.style.display = "block";
                }
              }
            } else {
              // AJAX request failed
              messageDiv.textContent = "Error occurred while logging in. Please try again later.";
              messageDiv.style.display = "block";
            }
          }
          const data = JSON.stringify({email: emailVal, password: passwordVal});
          
          xhr.send(data);
        });

        logoutLink.addEventListener("click", (e) => {
          e.preventDefault();
          localStorage.removeItem("token");
          logoutLink.style.display = "none";
          messageDiv.style.display = "none";
          loginForm.style.display = "block";

        });
        // end
      });
       
    </script>
  </body>
</html>
